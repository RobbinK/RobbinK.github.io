(function(e){e.fn.tagEditor=function(a){var i={separator:",",items:[],className:"tagEditor",confirmRemoval:!1,confirmRemovalText:"Do you really want to remove the tag?",completeOnSeparator:!1,completeOnBlur:!1,tagsBeforeField:!1,initialParse:!0,imageTag:!1,imageTagUrl:"",continuousOutputBuild:!1},a=a?e.extend(i,a):i,g,b=this,d,f=[];return this.each(function(){function k(c){for(var c=e.trim(c),b=0;b<f.length;b++)if(f[b].toLowerCase()==c.toLowerCase())return!1;var d=e(document.createElement("li"));
d.text(c);d.attr("title","Remove tag");a.imageTag&&d.append('<img src="'+a.imageTagUrl+'">');d.click(function(){if(!a.confirmRemoval||confirm(a.confirmRemovalText))d.remove(),h()});g.append(d);return!0}function i(){f=[];for(var c=e("li",g),b=0;b<c.length;b++)f.push(e.trim(e(c[b]).text()));a.continuousOutputBuild&&d.val(f.join(a.separator))}function h(){for(var c=b.val().split(a.separator),d=0;d<c.length;d++){var f=e.trim(c[d]);0<f.length&&k(f)}b.val("");i()}d=e(document.createElement("input"));d.attr("type",
"hidden");a.continuousOutputBuild&&(d.attr("name",b.attr("name")),b.attr("name",b.attr("name")+"_old"));b.after(d);g=e(document.createElement("ul"));g.attr("class",a.className);a.tagsBeforeField?e(this).before(g):e(this).after(g);for(var j=0;j<a.items.length;j++)k(e.trim(a.items[j]));a.initialParse&&h();a.completeOnBlur&&e(this).blur(h);i();e(this).keypress(function(c){c=c.which?c.which:c.keyCode;if(a.completeOnSeparator&&String.fromCharCode(c)==a.separator)return h(),!1;switch(c){case 13:return""!=
e.trim(b.val())?(h(),!1):!0}});j=e(this).parents("form");a.continuousOutputBuild||j.submit(function(){h();d.val(f.join(a.separator));d.attr("id",b.attr("id"));d.attr("name",b.attr("name"));b.attr("id",b.attr("id")+"_old");b.attr("name",b.attr("name")+"_old")});e.fn.extend({tagEditorGetTags:function(){return f.join(a.separator)},tagEditorResetTags:function(){f=[];g.html("");b.val("");d.val("");for(var c=0;c<a.items.length;c++)k(e.trim(a.items[c]));h()},tagEditorAddTag:function(a){return k(a)}})})}})(jQuery);
