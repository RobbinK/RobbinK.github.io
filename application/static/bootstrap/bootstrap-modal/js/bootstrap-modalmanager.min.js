!function(c){function f(a){return function(b){if(this===b.target)return a.apply(this,arguments)}}var i=function(a,b){this.init(a,b)};i.prototype={constructor:i,init:function(a,b){this.$element=c(a);this.options=c.extend({},c.fn.modalmanager.defaults,this.$element.data(),"object"==typeof b&&b);this.stack=[];this.backdropCount=0;if(this.options.resize){var d,e=this;c(window).on("resize.modal",function(){d&&clearTimeout(d);d=setTimeout(function(){for(var a=0;a<e.stack.length;a++)e.stack[a].isShown&&
e.stack[a].layout()},10)})}},createModal:function(a,b){c(a).modal(c.extend({manager:this},b))},appendModal:function(a){this.stack.push(a);var b=this;a.$element.on("show.modalmanager",f(function(){var d=function(){a.isShown=!0;var d=c.support.transition&&a.$element.hasClass("fade");b.$element.toggleClass("modal-open",b.hasOpenModal()).toggleClass("page-overflow",c(window).height()<b.$element.height());a.$parent=a.$element.parent();a.$container=b.createContainer(a);a.$element.appendTo(a.$container);
b.backdrop(a,function(){a.$element.show();d&&a.$element[0].offsetWidth;a.layout();a.$element.addClass("in").attr("aria-hidden",!1);var f=function(){b.setFocus();a.$element.trigger("shown")};d?a.$element.one(c.support.transition.end,f):f()})};a.options.replace?b.replace(d):d()}));a.$element.on("hidden.modalmanager",f(function(){b.backdrop(a);a.$element.parent().length?a.$backdrop?(c.support.transition&&a.$element.hasClass("fade")&&a.$element[0].offsetWidth,c.support.transition&&a.$element.hasClass("fade")?
a.$backdrop.one(c.support.transition.end,function(){a.destroy()}):a.destroy()):a.destroy():b.destroyModal(a)}));a.$element.on("destroyed.modalmanager",f(function(){b.destroyModal(a)}))},getOpenModals:function(){for(var a=[],b=0;b<this.stack.length;b++)this.stack[b].isShown&&a.push(this.stack[b]);return a},hasOpenModal:function(){return 0<this.getOpenModals().length},setFocus:function(){for(var a,b=0;b<this.stack.length;b++)this.stack[b].isShown&&(a=this.stack[b]);a&&a.focus()},destroyModal:function(a){a.$element.off(".modalmanager");
a.$backdrop&&this.removeBackdrop(a);this.stack.splice(this.getIndexOfModal(a),1);var b=this.hasOpenModal();this.$element.toggleClass("modal-open",b);b||this.$element.removeClass("page-overflow");this.removeContainer(a);this.setFocus()},getModalAt:function(a){return this.stack[a]},getIndexOfModal:function(a){for(var b=0;b<this.stack.length;b++)if(a===this.stack[b])return b},replace:function(a){for(var b,d=0;d<this.stack.length;d++)this.stack[d].isShown&&(b=this.stack[d]);b?(this.$backdropHandle=b.$backdrop,
b.$backdrop=null,a&&b.$element.one("hidden",f(c.proxy(a,this))),b.hide()):a&&a()},removeBackdrop:function(a){a.$backdrop.remove();a.$backdrop=null},createBackdrop:function(a,b){var d;this.$backdropHandle?(d=this.$backdropHandle,d.off(".modalmanager"),this.$backdropHandle=null,this.isLoading&&this.removeSpinner()):d=c(b).addClass(a).appendTo(this.$element);return d},removeContainer:function(a){a.$container.remove();a.$container=null},createContainer:function(a){var b;b=c('<div class="modal-scrollable">').css("z-index",
g("modal",this.getOpenModals().length)).appendTo(this.$element);if(a&&"static"!=a.options.backdrop)b.on("click.modal",f(function(){a.hide()}));else if(a)b.on("click.modal",f(function(){a.attention()}));return b},backdrop:function(a,b){var d=a.$element.hasClass("fade")?"fade":"",e=a.options.backdrop&&this.backdropCount<this.options.backdropLimit;if(a.isShown&&e)e=c.support.transition&&d&&!this.$backdropHandle,a.$backdrop=this.createBackdrop(d,a.options.backdropTemplate),a.$backdrop.css("z-index",g("backdrop",
this.getOpenModals().length)),e&&a.$backdrop[0].offsetWidth,a.$backdrop.addClass("in"),this.backdropCount+=1,e?a.$backdrop.one(c.support.transition.end,b):b();else if(!a.isShown&&a.$backdrop){a.$backdrop.removeClass("in");this.backdropCount-=1;var f=this;c.support.transition&&a.$element.hasClass("fade")?a.$backdrop.one(c.support.transition.end,function(){f.removeBackdrop(a)}):f.removeBackdrop(a)}else b&&b()},removeSpinner:function(){this.$spinner&&this.$spinner.remove();this.$spinner=null;this.isLoading=
!1},removeLoading:function(){this.$backdropHandle&&this.$backdropHandle.remove();this.$backdropHandle=null;this.removeSpinner()},loading:function(a){a=a||function(){};this.$element.toggleClass("modal-open",!this.isLoading||this.hasOpenModal()).toggleClass("page-overflow",c(window).height()<this.$element.height());if(this.isLoading)if(this.isLoading&&this.$backdropHandle){this.$backdropHandle.removeClass("in");var b=this;c.support.transition?this.$backdropHandle.one(c.support.transition.end,function(){b.removeLoading()}):
b.removeLoading()}else a&&a(this.isLoading);else{this.$backdropHandle=this.createBackdrop("fade",this.options.backdropTemplate);this.$backdropHandle[0].offsetWidth;var d=this.getOpenModals();this.$backdropHandle.css("z-index",g("backdrop",d.length+1)).addClass("in");d=c(this.options.spinner).css("z-index",g("modal",d.length+1)).appendTo(this.$element).addClass("in");this.$spinner=c(this.createContainer()).append(d).on("click.modalmanager",c.proxy(this.loading,this));this.isLoading=!0;c.support.transition?
this.$backdropHandle.one(c.support.transition.end,a):a()}}};var g,j,h={};g=function(a,b){if("undefined"===typeof j){var d=c('<div class="modal hide" />').appendTo("body"),e=c('<div class="modal-backdrop hide" />').appendTo("body");h.modal=+d.css("z-index");h.backdrop=+e.css("z-index");j=h.modal-h.backdrop;d.remove();e.remove()}return h[a]+j*b};c.fn.modalmanager=function(a,b){return this.each(function(){var d=c(this),e=d.data("modalmanager");e||d.data("modalmanager",e=new i(this,a));"string"===typeof a&&
e[a].apply(e,[].concat(b))})};c.fn.modalmanager.defaults={backdropLimit:999,resize:!0,spinner:'<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>',backdropTemplate:'<div class="modal-backdrop" />'};c.fn.modalmanager.Constructor=i;c(function(){c(document).off("show.bs.modal").off("hidden.bs.modal")})}(jQuery);
